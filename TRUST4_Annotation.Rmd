---
title: "Second_TRUST4_AnnotationAttempt"
output: html_document
date: "2023-11-21"
---

Load libraries etc.
```{r}
library(Seurat)
library(ggplot2)
library(ArchR)
library(dplyr)
library(immunarch)
library(BSgenome.Hsapiens.UCSC.hg38)
addArchRThreads(threads = 1)
addArchRGenome("hg38")
options(future.globals.maxSize=10000000000000000) 
```
Load aggregated TRUST4 BCR data bam reports
```{r}
library(immunarch)
wm <- repLoad("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/bam_reports")
wm$data[[12]]
```
Load in
```{r}
#archR <- loadArchRProject(path = "/Users/gagled01/morganLab/Waldenstroms/Waldenstroms_Git/WM_NoControls_NoProgens_DownstreamObject")
```
Read in Immunarch style reports
```{r}
# Load barcode files
p01_076_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_01-076_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p01_115_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_01-115_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p01_131_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_01-131_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p01_163_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_01-163_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p01_190_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_01-190_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p04_003_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_04-003_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
p04_006_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_04-006_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm25_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM25_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm43_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM43_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm46_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM46_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm47_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM47_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm54_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM54_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
wm65_barcodes <- read.table("/Users/gagled01/morganLab/Waldenstroms/TRUST4_working/outputs/barcode_reports/TRUST_WM65_gex_possorted_bam_barcode_airr.tsv", sep = "\t", header = T)
```
Check patient barcodes match
```{r}
cell_id_fixed <- gsub("0.-..._", "", archR$cellNames_clean)
archR$cell_id_fixed <- cell_id_fixed
cell_id_fixed2 <- gsub("-1", "", archR$cell_id_fixed)
archR$cell_id_fixed <- cell_id_fixed2
cell_id_fixed3 <- gsub("WM..", "", archR$cell_id_fixed)
archR$cell_id_fixed <- cell_id_fixed3

# Wait actually need this
patient_barcode <- gsub("-1$", "", archR$cellNames_clean) # need to use $ to specify end of string bcuz otherwise the -1 in 01-115 (and the 3 other patients like this) will get replaced!!! fucking up matching!!!
archR$patient_barcode_clean <- patient_barcode
```
# Fixing TRUST4 barcodes in the TRUST4 output for each patient
```{r}
# Fix cell ids
p01_076_barcodes$cell_id_fixed <- gsub("-1", "", p01_076_barcodes$cell_id) # remove the -1
p01_076_barcodes$patient_barcode_clean <- paste0("01-076_", p01_076_barcodes$cell_id_fixed) # add the patient as prefix. if you do not fix cell types like this you run the risk of overmatching due to NON-UNIQUENESS OF CELL BARCODES between patients
p01_076_barcodes$sample <- "01-076"

p01_115_barcodes$cell_id_fixed <- gsub("-1$", "", p01_115_barcodes$cell_id)
p01_115_barcodes$patient_barcode_clean <- paste0("01-115_", p01_115_barcodes$cell_id_fixed)
p01_115_barcodes$sample <- "01-115"

p01_131_barcodes$cell_id_fixed <- gsub("-1$", "", p01_131_barcodes$cell_id)
p01_131_barcodes$patient_barcode_clean <- paste0("01-131_", p01_131_barcodes$cell_id_fixed)
p01_131_barcodes$sample <- "01-131"

p01_163_barcodes$cell_id_fixed <- gsub("-1$", "", p01_163_barcodes$cell_id)
p01_163_barcodes$patient_barcode_clean <- paste0("01-163_", p01_163_barcodes$cell_id_fixed)
p01_163_barcodes$sample <- "01-163"

p01_190_barcodes$cell_id_fixed <- gsub("-1$", "", p01_190_barcodes$cell_id)
p01_190_barcodes$patient_barcode_clean <- paste0("01-190_", p01_190_barcodes$cell_id_fixed)
p01_190_barcodes$sample <- "01-190"

p04_003_barcodes$cell_id_fixed <- gsub("-1$", "", p04_003_barcodes$cell_id)
p04_003_barcodes$patient_barcode_clean <- paste0("04-003_", p04_003_barcodes$cell_id_fixed)
p04_003_barcodes$sample <- "04-003"

p04_006_barcodes$cell_id_fixed <- gsub("-1$", "", p04_006_barcodes$cell_id)
p04_006_barcodes$patient_barcode_clean <- paste0("04-006_", p04_006_barcodes$cell_id_fixed)
p04_006_barcodes$sample <- "04-006"

wm25_barcodes$cell_id_fixed <- gsub("-1$", "", wm25_barcodes$cell_id)
wm25_barcodes$patient_barcode_clean <- paste0("WM25_", wm25_barcodes$cell_id_fixed)
wm25_barcodes$sample <- "WM25"

wm43_barcodes$cell_id_fixed <- gsub("-1$", "", wm43_barcodes$cell_id)
wm43_barcodes$patient_barcode_clean <- paste0("WM43_", wm43_barcodes$cell_id_fixed)
wm43_barcodes$sample <- "WM43"

wm46_barcodes$cell_id_fixed <- gsub("-1$", "", wm46_barcodes$cell_id)
wm46_barcodes$patient_barcode_clean <- paste0("WM46_", wm46_barcodes$cell_id_fixed)
wm46_barcodes$sample <- "WM46"

wm47_barcodes$cell_id_fixed <- gsub("-1$", "", wm47_barcodes$cell_id)
wm47_barcodes$patient_barcode_clean <- paste0("WM47_", wm47_barcodes$cell_id_fixed)
wm47_barcodes$sample <- "WM47"

wm54_barcodes$cell_id_fixed <- gsub("-1$", "", wm54_barcodes$cell_id)
wm54_barcodes$patient_barcode_clean <- paste0("WM54_", wm54_barcodes$cell_id_fixed)
wm54_barcodes$sample <- "WM54"

wm65_barcodes$cell_id_fixed <- gsub("-1$", "", wm65_barcodes$cell_id)
wm65_barcodes$patient_barcode_clean <- paste0("WM65_", wm65_barcodes$cell_id_fixed)
wm65_barcodes$sample <- "WM65"

length(intersect(archR$patient_barcode_clean, p01_076_barcodes$patient_barcode_clean)) # they all match nice
length(intersect(archR$patient_barcode_clean, p01_115_barcodes$patient_barcode_clean)) 
length(intersect(archR$patient_barcode_clean, p01_131_barcodes$patient_barcode_clean)) 
length(intersect(archR$patient_barcode_clean, p01_163_barcodes$patient_barcode_clean)) 
length(intersect(archR$patient_barcode_clean, p01_190_barcodes$patient_barcode_clean)) 
length(intersect(archR$patient_barcode_clean, p04_003_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, p04_006_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm25_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm43_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm46_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm47_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm54_barcodes$patient_barcode_clean))
length(intersect(archR$patient_barcode_clean, wm65_barcodes$patient_barcode_clean))

# Merge into single df
all_barcodes <- rbind(p01_076_barcodes, p01_115_barcodes, p01_131_barcodes, p01_163_barcodes,p01_190_barcodes, p04_003_barcodes, p04_006_barcodes,
                      wm25_barcodes, wm43_barcodes, wm46_barcodes, wm47_barcodes, wm54_barcodes, wm65_barcodes)

all_barcodes
wm54_barcodes
```
Annotate ArchR Patients with TRUST4 info
```{r}
archR$topCDR3s <- NA
archR$hasTopCDR3 <- "No"

wm$data[[1]]
p01_076.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQFDSSWTF"]
length(intersect(p01_076.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p01_076.cells.with] <- "CQQFDSSWTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p01_076.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[2]]
p01_115.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CLQRGNWPLTF"]
length(intersect(p01_115.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p01_115.cells.with] <- "CLQRGNWPLTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p01_115.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)


wm$data[[3]]
p01_131.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYYSIPTF"]
length(intersect(p01_131.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p01_131.cells.with] <- "CQQYYSIPTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p01_131.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[4]]
p01_163.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYNNWPPLTF"]
length(intersect(p01_163.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p01_163.cells.with] <- "CQQYNNWPPLTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p01_163.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[5]]
p01_190.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYNNWPITF"]
length(intersect(p01_190.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p01_190.cells.with] <- "CQQYNNWPITF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p01_190.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[6]]
p04_003.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYDSYPYTF"]
length(intersect(p04_003.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p04_003.cells.with] <- "CQQYDSYPYTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p04_003.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[7]]
p04_006.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYGTSSLTF"]
length(intersect(p04_006.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% p04_006.cells.with] <- "CQQYGTSSLTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% p04_006.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[8]]
wm25.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CMQALQTPRTF"]
length(intersect(wm25.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm25.cells.with] <- "CMQALQTPRTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm25.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[9]]
wm43.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYNTYPWTF"]
length(intersect(wm43.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm43.cells.with] <- "CQQYNTYPWTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm43.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[10]]
wm46.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYNNWPRTF"]
length(intersect(wm46.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm46.cells.with] <- "CQQYNNWPRTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm46.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[11]]
wm47.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYGSSSSYTF"]
length(intersect(wm47.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm47.cells.with] <- "CQQYGSSSSYTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm47.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[12]]
wm54.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQCGDWPLTF"]
length(intersect(wm54.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm54.cells.with] <- "CQQCGDWPLTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm54.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

wm$data[[13]]
wm65.cells.with <- all_barcodes$patient_barcode_clean[all_barcodes$junction_aa == "CQQYNSYPYTF"]
length(intersect(wm65.cells.with, archR$patient_barcode_clean))
archR$topCDR3s[archR$patient_barcode_clean %in% wm65.cells.with] <- "CQQYNSYPYTF"
archR$hasTopCDR3[archR$patient_barcode_clean %in% wm65.cells.with] <- "Yes"
table(archR$topCDR3s)
table(archR$hasTopCDR3)

p1 <- plotEmbedding(archR, embedding = "BLineage_Recluster_UMAP", name = "topCDR3s")
p2 <- plotEmbedding(archR, embedding = "BLineage_Recluster_UMAP", name = "hasTopCDR3")

plotPDF(p1, p2, name = "Blineage_Recluster_TopCDR3_UMAP", width = 5, height = 5, ArchRProj = archR, addDOC = FALSE)
```
# Patient subset function
```{r}
patient_subset <- function(archR_obj, id_str) {
  idx <- BiocGenerics::which(archR$samplesClean == id_str)
  cells <- archR_obj$cellNames[idx]
  sub_archR <- archR_obj[cells,]
  return(sub_archR)
}
```
# Run it on em
```{r}
p01_076_archR <- patient_subset(archR, "01-076")
p01_115_archR <- patient_subset(archR, "01-115")
p01_131_archR <- patient_subset(archR, "01-131")
p01_163_archR <- patient_subset(archR, "01-163")
p01_190_archR <- patient_subset(archR, "01-190")
p04_003_archR <- patient_subset(archR, "04-003")
p04_006_archR <- patient_subset(archR, "04-006")
wm25_archR <- patient_subset(archR, "WM25")
wm43_archR <- patient_subset(archR, "WM43")
wm46_archR <- patient_subset(archR, "WM46")
wm47_archR <- patient_subset(archR, "WM47")
wm54_archR <- patient_subset(archR, "WM54")
wm65_archR <- patient_subset(archR, "WM65")
```
Reclustering individual patients and plot
```{r}
patient_recluster <- function(archR_obj, sample_str) {
  print(paste0("Reclustering patient ", sample_str, "..."))
  print("Running Iterative LSI...")
  
  # Add iterative LSI
  archR_obj <- addIterativeLSI(
  ArchRProj = archR_obj,
  useMatrix = "TileMatrix",
  name = "Patient_Recluster",
  iterations = 2,
  clusterParams = list( # based on Seurat's FindClusters()
    resolution = c(0.25),
    sampleCells = 2000,
    n.start = 10
  ),
  varFeatures = 20000,
  dimsToUse = 1:20,
  force = T
)

  print("Adding UMAP...")
# Add UMAP
  archR_obj <- addUMAP(
      ArchRProj = archR_obj, 
      reducedDims = "Patient_Recluster", 
      name = "Patient_Recluster_UMAP", 
      nNeighbors = 30, 
      minDist = 0.5, 
      metric = "cosine",
      force = T
  )
  return(archR_obj)
}
```
# Alternative clustering for WM46 and 65 (bcuz they are too homogenous!)
```{r}
patient_recluster2 <- function(archR_obj, sample_str) {
  print(paste0("Reclustering patient ", sample_str, "..."))
  print("Running Iterative LSI...")
  
  # Add iterative LSI
  archR_obj <- addIterativeLSI(
  ArchRProj = archR_obj,
  useMatrix = "TileMatrix",
  name = "Patient_Recluster",
  iterations = 2,
  clusterParams = list( # based on Seurat's FindClusters()
    resolution = c(0.25),
    sampleCells = 2000,
    n.start = 10
  ),
  varFeatures = 20000,
  dimsToUse = 1:10,
  force = T
)

  print("Adding UMAP...")
# Add UMAP
  archR_obj <- addUMAP(
      ArchRProj = archR_obj, 
      reducedDims = "Patient_Recluster", 
      name = "Patient_Recluster_UMAP", 
      nNeighbors = 30, 
      minDist = 0.5, 
      metric = "cosine",
      force = T
  )
  return(archR_obj)
}
```

```{r}
p01_076_archR <- patient_recluster(p01_076_archR, "01-076")
p01_115_archR <- patient_recluster(p01_115_archR, "01-115")
p01_131_archR <- patient_recluster(p01_131_archR, "01-131")
p01_163_archR <- patient_recluster(p01_163_archR, "01-163")
p01_190_archR <- patient_recluster(p01_190_archR, "01-190")
p04_003_archR <- patient_recluster(p04_003_archR, "04-003")
p04_006_archR <- patient_recluster(p04_006_archR, "04-006")
wm25_archR <- patient_recluster(wm25_archR, "WM25")
wm43_archR <- patient_recluster(wm43_archR, "WM43")
wm46_archR <- patient_recluster2(wm46_archR, "WM46")
wm47_archR <- patient_recluster(wm47_archR, "WM47")
wm54_archR <- patient_recluster(wm54_archR, "WM54")
wm65_archR <- patient_recluster2(wm65_archR, "WM65")
```
# Exploring secondary clones for WM54
```{r}
# 01-076
p01_076_archR$primaryClone <- NA
p01_076_archR$secondaryClone <- NA
p01_076_archR$tertiaryClone <- NA
p01_076.cells.with <- p01_076_barcodes$patient_barcode_clean[p01_076_barcodes$junction_aa == "CQQFDSSWTF"]
p01_076_archR$primaryClone[p01_076_archR$patient_barcode_clean %in% p01_076.cells.with] <- "CQQFDSSWTF"

p01_076.cells.with <- p01_076_barcodes$patient_barcode_clean[p01_076_barcodes$junction_aa == "CQAWDSNSHVF"]
p01_076_archR$secondaryClone[p01_076_archR$patient_barcode_clean %in% p01_076.cells.with] <- "CQAWDSNSHVF"

p01_076.cells.with <- p01_076_barcodes$patient_barcode_clean[p01_076_barcodes$junction_aa == "CSRNKRLGQPAGPFFDYW"]
p01_076_archR$tertiaryClone[p01_076_archR$patient_barcode_clean %in% p01_076.cells.with] <- "CSRNKRLGQPAGPFFDYW"

# 01-115
p01_115_archR$primaryClone <- NA
p01_115_archR$secondaryClone <- NA
p01_115_archR$tertiaryClone <- NA
temp <- c("CLQRGNWPLTF", "CQKYNSYFIF", "CCSYAGTWTWLF")
p01_115.cells.with <- p01_115_barcodes$patient_barcode_clean[p01_115_barcodes$junction_aa == "CLQRGNWPLTF"]
p01_115_archR$primaryClone[p01_115_archR$patient_barcode_clean %in% p01_115.cells.with] <- "CLQRGNWPLTF"

p01_115.cells.with <- p01_115_barcodes$patient_barcode_clean[p01_115_barcodes$junction_aa == "CCSYAGTWTWLF"]
p01_115_archR$secondaryClone[p01_115_archR$patient_barcode_clean %in% p01_115.cells.with] <- "CCSYAGTWTWLF"

p01_115.cells.with <- p01_115_barcodes$patient_barcode_clean[p01_115_barcodes$junction_aa == "CQKYNSYFIF"]
p01_115_archR$tertiaryClone[p01_115_archR$patient_barcode_clean %in% p01_115.cells.with] <- "CQKYNSYFIF"

# 01-131
p01_131_archR$primaryClone <- NA
p01_131_archR$secondaryClone <- NA
p01_131.cells.with <- p01_131_barcodes$patient_barcode_clean[p01_131_barcodes$junction_aa == "CQQYYSIPTF"]
p01_131_archR$primaryClone[p01_131_archR$patient_barcode_clean %in% p01_131.cells.with] <- "CQQYYSIPTF"

p01_131.cells.with <- p01_131_barcodes$patient_barcode_clean[p01_131_barcodes$junction_aa == "CNSRDSSGNHAVF"]
p01_131_archR$secondaryClone[p01_131_archR$patient_barcode_clean %in% p01_131.cells.with] <- "CNSRDSSGNHAVF"

# 01-163
p01_163_archR$primaryClone <- NA
p01_163_archR$secondaryClone <- NA
p01_163.cells.with <- p01_163_barcodes$patient_barcode_clean[p01_163_barcodes$junction_aa == "CQQYNNWPPLTF"]
p01_163_archR$primaryClone[p01_163_archR$patient_barcode_clean %in% p01_163.cells.with] <- "CQQYNNWPPLTF"

p01_163.cells.with <- p01_163_barcodes$patient_barcode_clean[p01_163_barcodes$junction_aa == "CLQRGNWPLTF"]
p01_163_archR$secondaryClone[p01_163_archR$patient_barcode_clean %in% p01_163.cells.with] <- "CLQRGNWPLTF"


# 01-190
p01_190_archR$primaryClone <- NA
p01_190_archR$secondaryClone <- NA
p01_190.cells.with <- p01_190_barcodes$patient_barcode_clean[p01_190_barcodes$junction_aa == "CQQYNNWPITF"]
p01_190_archR$primaryClone[p01_190_archR$patient_barcode_clean %in% p01_190.cells.with] <- "CQQYNNWPITF"

p01_190.cells.with <- p01_190_barcodes$patient_barcode_clean[p01_190_barcodes$junction_aa == "CQHYDNLPLTF"]
p01_190_archR$secondaryClone[p01_190_archR$patient_barcode_clean %in% p01_190.cells.with] <- "CQHYDNLPLTF"

# 04-003
p04_003_archR$primaryClone <- NA
p04_003_archR$secondaryClone <- NA
p04_003_archR$tertiaryClone <- NA
p04_003.cells.with <- p04_003_barcodes$patient_barcode_clean[p04_003_barcodes$junction_aa == "CQQYDSYPYTF"]
p04_003_archR$primaryClone[p04_003_archR$patient_barcode_clean %in% p04_003.cells.with] <- "CQQYDSYPYTF"

p04_003.cells.with <- p04_003_barcodes$patient_barcode_clean[p04_003_barcodes$junction_aa == "CQQTFDYRTF"]
p04_003_archR$secondaryClone[p04_003_archR$patient_barcode_clean %in% p04_003.cells.with] <- "CQQTFDYRTF"

p04_003.cells.with <- p04_003_barcodes$patient_barcode_clean[p04_003_barcodes$junction_aa == "CQAWDSNTVIF"]
p04_003_archR$tertiaryClone[p04_003_archR$patient_barcode_clean %in% p04_003.cells.with] <- "CQAWDSNTVIF"

# 04-006
p04_006_archR$primaryClone <- NA
p04_006_archR$secondaryClone <- NA
p04_006.cells.with <- p04_006_barcodes$patient_barcode_clean[p04_006_barcodes$junction_aa == "CQQYGTSSLTF"]
p04_006_archR$primaryClone[p04_006_archR$patient_barcode_clean %in% p04_006.cells.with] <- "CQQYGTSSLTF"

p04_006.cells.with <- p04_006_barcodes$patient_barcode_clean[p04_006_barcodes$junction_aa == "CQQYNNWPPLTF"]
p04_006_archR$secondaryClone[p04_006_archR$patient_barcode_clean %in% p04_006.cells.with] <- "CQQYNNWPPLTF"

# WM25
wm25_archR$primaryClone <- NA
wm25_archR$secondaryClone <- NA
wm25.cells.with <- wm25_barcodes$patient_barcode_clean[wm25_barcodes$junction_aa == "CMQALQTPRTF"]
wm25_archR$primaryClone[wm25_archR$patient_barcode_clean %in% wm25.cells.with] <- "CMQALQTPRTF"

wm25.cells.with <- wm25_barcodes$patient_barcode_clean[wm25_barcodes$junction_aa == "CQAWDSNTLVF"]
wm25_archR$secondaryClone[wm25_archR$patient_barcode_clean %in% wm25.cells.with] <- "CQAWDSNTLVF"

# wm43
wm43_archR$primaryClone <- NA
wm43_archR$secondaryClone <- NA
wm43_archR$tertiaryClone <- NA
wm43.cells.with <- wm43_barcodes$patient_barcode_clean[wm43_barcodes$junction_aa == "CQQYNTYPWTF"]
wm43_archR$primaryClone[wm43_archR$patient_barcode_clean %in% wm43.cells.with] <- "CQQYNTYPWTF"

wm43.cells.with <- wm43_barcodes$patient_barcode_clean[wm43_barcodes$junction_aa == "CQAWDSSAVLF"]
wm43_archR$secondaryClone[wm43_archR$patient_barcode_clean %in% wm43.cells.with] <- "CQAWDSSAVLF"

# wm46
wm46_archR$primaryClone <- NA
wm46_archR$secondaryClone <- NA
wm46_archR$tertiaryClone <- NA
wm46.cells.with <- wm46_barcodes$patient_barcode_clean[wm46_barcodes$junction_aa == "CQQYNNWPRTF"]
wm46_archR$primaryClone[wm46_archR$patient_barcode_clean %in% wm46.cells.with] <- "CQQYNNWPRTF"

wm46.cells.with <- wm46_barcodes$patient_barcode_clean[wm46_barcodes$junction_aa == "CQQYNSWPRTF"]
wm46_archR$secondaryClone[wm46_archR$patient_barcode_clean %in% wm46.cells.with] <- "CQQYNSWPRTF"

# wm46
wm47_archR$primaryClone <- NA
wm47_archR$secondaryClone <- NA
wm47_archR$tertiaryClone <- NA
wm47.cells.with <- wm47_barcodes$patient_barcode_clean[wm47_barcodes$junction_aa == "CQQYGSSSSYTF"]
wm47_archR$primaryClone[wm47_archR$patient_barcode_clean %in% wm47.cells.with] <- "CQQYGSSSSYTF"

wm47.cells.with <- wm47_barcodes$patient_barcode_clean[wm47_barcodes$junction_aa == "CHQGVF"]
wm47_archR$secondaryClone[wm47_archR$patient_barcode_clean %in% wm47.cells.with] <- "CHQGVF"

# Secondary for WM54
wm54_archR$primaryClone <- NA
wm54_archR$secondaryClone <- NA
wm54.cells.with <- wm54_barcodes$patient_barcode_clean[wm54_barcodes$junction_aa == "CQQCGDWPLTF"]
wm54_archR$primaryClone[wm54_archR$patient_barcode_clean %in% wm54.cells.with] <- "CQQCGDWPLTF"
wm54.cells.with <- wm54_barcodes$patient_barcode_clean[wm54_barcodes$junction_aa == "CQQYYSTPRTF"]
wm54_archR$secondaryClone[wm54_archR$patient_barcode_clean %in% wm54.cells.with] <- "CQQYYSTPRTF"

# wm65
wm65_archR$primaryClone <- NA
wm65_archR$secondaryClone <- NA
wm65_archR$tertiaryClone <- NA
wm65.cells.with <- wm65_barcodes$patient_barcode_clean[wm65_barcodes$junction_aa == "CQQYNSYPYTF"]
wm65_archR$primaryClone[wm65_archR$patient_barcode_clean %in% wm65.cells.with] <- "CQQYNSYPYTF"

wm65.cells.with <- wm65_barcodes$patient_barcode_clean[wm65_barcodes$junction_aa == "CQQYYSTPRTF"]
wm65_archR$secondaryClone[wm65_archR$patient_barcode_clean %in% wm65.cells.with] <- "CQQYYSTPRTF"
```
# Supplementary Figure 5...individual reclusters plotted by TRUST4 clonality
```{r}
cols <- c("gray", "firebrick")
names(cols) <- names(table(p01_076_archR$hasTopCDR3)) 
p1 <- plotEmbedding(p01_076_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("01-076") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p1, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-076_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p01_115_archR$hasTopCDR3)) 
p2 <- plotEmbedding(p01_115_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("01-115") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p2, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-115_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p01_131_archR$hasTopCDR3)) 
p3 <- plotEmbedding(p01_131_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("01-131") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p3, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-131_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p01_163_archR$hasTopCDR3)) 
p4 <- plotEmbedding(p01_163_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("01-163") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p4, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-163_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p01_190_archR$hasTopCDR3)) 
p5 <- plotEmbedding(p01_190_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("01-190") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p5, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-190_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p04_003_archR$hasTopCDR3)) 
p6 <- plotEmbedding(p04_003_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("04-003") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p6, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_04-003_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(p04_006_archR$hasTopCDR3)) 
p7 <- plotEmbedding(p04_006_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("04-006") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p7, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_04-006_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(wm25_archR$hasTopCDR3)) 
p8 <- plotEmbedding(wm25_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("WM25") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p8, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM25_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(wm43_archR$hasTopCDR3)) 
p9 <- plotEmbedding(wm43_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("WM43") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p9, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM43_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(wm46_archR$hasTopCDR3)) 
p10 <- plotEmbedding(wm46_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("WM46") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p10, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM46_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(wm47_archR$hasTopCDR3)) 
p11 <- plotEmbedding(wm47_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("WM47") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p11, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM47_Recluster_TRUST4.png", width = 6, height = 6) 

wm54_archR$trust4_anno <- wm54_archR$hasTopCDR3
wm54_archR$trust4_anno[wm54_archR$secondaryClone == "CQQYYSTPRTF"] <- "Secondary Clone"
cols <- c("gray", "slateblue", "firebrick")
names(cols) <- names(table(wm54_archR$trust4_anno)) 
p12 <- plotEmbedding(wm54_archR, embedding = "Patient_Recluster_UMAP", name = "trust4_anno", pal = cols) + ggtitle("WM54") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p12, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM54_Recluster_TRUST4.png", width = 6, height = 6) 

cols <- c("gray", "firebrick")
names(cols) <- names(table(wm65_archR$hasTopCDR3)) 
p13 <- plotEmbedding(wm65_archR, embedding = "Patient_Recluster_UMAP", name = "hasTopCDR3", pal = cols) + ggtitle("WM65") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave(p13, filename = "/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM65_Recluster_TRUST4.png", width = 6, height = 6) 
```
# Supplementary Figure 6...individual reclusters with cell type
```{r}
cols <- table(archR$final_annotation)
names(cols) <- names(table(archR$final_annotation)) 
cols[1] <- "lightseagreen" # clonal PC
cols[2] <- "forestgreen" # WM43
cols[3] <- "firebrick" # PC-like MBC
cols[4] <- "slateblue" # MBC-like MBC
cols[5] <- "thistle2" # polyclonal MBC
cols[6] <- "orange1"
  
colors <- c("slateblue", "firebrick", "thistle2", "orange1", "lightseagreen", "forestgreen") # MBC-like, PClike, polyclonal MBC, polyclonal PC, clonal PC, WM43

cols <- c(colors[5], colors[1], colors[3], colors[4])
names(cols) <- names(table(p01_076_archR$final_annotation)) 
plotEmbedding(p01_076_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("01-076") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-076_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(p01_115_archR$final_annotation)) 
plotEmbedding(p01_115_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("01-115") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-115_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(p01_131_archR$final_annotation)) 
plotEmbedding(p01_131_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("01-131") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-131_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3])
names(cols) <- names(table(p01_163_archR$final_annotation)) 
plotEmbedding(p01_163_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("01-163") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-163_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[3], colors[4])
names(cols) <- names(table(p01_190_archR$final_annotation)) 
plotEmbedding(p01_190_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("01-190") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_01-190_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(p04_003_archR$final_annotation)) 
plotEmbedding(p04_003_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("04-003") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_04-003_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(p04_006_archR$final_annotation)) 
plotEmbedding(p04_006_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("04-006") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_04-006_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(wm25_archR$final_annotation)) 
plotEmbedding(wm25_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM25") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM25_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[1], colors[2], colors[6])
names(cols) <- names(table(wm43_archR$final_annotation)) 
plotEmbedding(wm43_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM43") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM43_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[3], colors[4])
names(cols) <- names(table(wm46_archR$final_annotation)) 
plotEmbedding(wm46_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM46") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM46_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[3], colors[4])
names(cols) <- names(table(wm47_archR$final_annotation)) 
plotEmbedding(wm47_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM47") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM47_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[2], colors[3], colors[4])
names(cols) <- names(table(wm54_archR$final_annotation)) 
plotEmbedding(wm54_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM54") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM54_Recluster_finalAnno.png", width = 6, height = 6)

cols <- c(colors[5], colors[1], colors[3], colors[4])
names(cols) <- names(table(wm65_archR$final_annotation)) 
plotEmbedding(wm65_archR, embedding = "Patient_Recluster_UMAP", name = "final_annotation", pal = cols) + ggtitle("WM65") + 
  theme(axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(hjust = 0.5, size = 24, face = "bold")) + NoLegend()
ggsave("/Users/gagled01/morganLab/Waldenstroms/singlecell/figures/WM_Supplementary_WM65_Recluster_finalAnno.png", width = 6, height = 6)

names(table(p01_076_archR$final_annotation)) 
names(table(p01_115_archR$final_annotation)) 
names(table(p01_131_archR$final_annotation)) 
names(table(p01_163_archR$final_annotation)) 
names(table(p01_190_archR$final_annotation))
names(table(p04_003_archR$final_annotation)) 
names(table(p04_006_archR$final_annotation)) 
names(table(wm25_archR$final_annotation)) 
names(table(wm43_archR$final_annotation)) 
names(table(wm46_archR$final_annotation)) 
names(table(wm47_archR$final_annotation)) 
names(table(wm54_archR$final_annotation)) 
names(table(wm65_archR$final_annotation)) 
```

SAVE IT OUT!!!
```{r}
#saveArchRProject(ArchRProj = archR, outputDirectory = "WM_BLineageOnly_TRUST4_Added", load = F)
```

```{r}
# get percentages of clonal vs non-clonal cells per patient
table(p01_076_archR$hasTopCDR3)/sum(table(p01_076_archR$hasTopCDR3))*100
table(p01_115_archR$hasTopCDR3)/sum(table(p01_115_archR$hasTopCDR3))*100
table(p01_131_archR$hasTopCDR3)/sum(table(p01_131_archR$hasTopCDR3))*100
table(p01_163_archR$hasTopCDR3)/sum(table(p01_163_archR$hasTopCDR3))*100
table(p01_190_archR$hasTopCDR3)/sum(table(p01_190_archR$hasTopCDR3))*100
table(p04_003_archR$hasTopCDR3)/sum(table(p04_003_archR$hasTopCDR3))*100
table(p04_006_archR$hasTopCDR3)/sum(table(p04_006_archR$hasTopCDR3))*100
table(wm25_archR$hasTopCDR3)/sum(table(wm25_archR$hasTopCDR3))*100
table(wm43_archR$hasTopCDR3)/sum(table(wm43_archR$hasTopCDR3))*100
table(wm46_archR$hasTopCDR3)/sum(table(wm46_archR$hasTopCDR3))*100
table(wm47_archR$hasTopCDR3)/sum(table(wm47_archR$hasTopCDR3))*100
table(wm54_archR$trust4_anno)/sum(table(wm54_archR$hasTopCDR3))*100
table(wm65_archR$hasTopCDR3)/sum(table(wm65_archR$hasTopCDR3))*100

```

